<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investment Planning Scenarios</title>
  <style>
    /* Reset & Base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Helvetica Neue', Arial, sans-serif; background: #f4f6f9; color: #333; line-height: 1.6; }
    /* Container */
    .container { max-width: 900px; margin: 40px auto; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; }
    /* Header */
    .header { background: #1e5aad; color: #fff; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
    .header .logo { font-size: 1.4rem; font-weight: bold; }
    .header .contact { font-size: 0.9rem; text-align: right; }
    /* Main Content */
    .content { padding: 30px; }
    .content h1 { font-size: 1.8rem; margin-bottom: 8px; }
    .content p { font-size: 1rem; color: #555; margin-bottom: 24px; }
    /* Controls */
    .controls { margin-bottom: 16px; display: flex; gap: 10px; }
    .btn { padding: 8px 16px; background: #1e5aad; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #154a8c; }
    /* Table */
    table { width: 100%; border-collapse: separate; border-spacing: 0; margin-bottom: 24px; background: #f8f9fb; }
    th, td { padding: 0; text-align: center; height: 44px; }
    th {
      background: #f5f7fa;
      font-weight: 600;
      color: #444;
      height: 44px;
      vertical-align: middle;
    }
    tr + tr { border-top: none; }
    td input {
      width: 110px; /* fits 7 digits comfortably */
      min-width: 70px;
      max-width: 110px;
      padding: 6px;
      border: 1.5px solid #bbb;
      border-radius: 6px;
      text-align: center;
      font-size: 1rem;
      box-sizing: border-box;
      display: block;
      margin: 0 auto;
      background: #fff;
      transition: border 0.2s;
    }
    td input:focus {
      border: 1.5px solid #1e5aad;
      outline: none;
      background: #eef3fa;
    }
    td.number { color: #222; font-weight: bold; }
    td { border-right: 1.5px solid #e0e0e0; border-bottom: 1.5px solid #e0e0e0; background: #fff; }
    tr:last-child td { border-bottom: none; }
    tr td:last-child, tr th:last-child { border-right: none; }
    tr td, tr th { position: relative; }
    tr td:not(:first-child):not(:last-child), tr th:not(:first-child):not(:last-child) {
      box-shadow: 0 0 0 1.5px #e0e0e0 inset;
    }
    tr td, tr th {
      border-radius: 0 !important;
    }
    /* Totals */
    .totals { display: flex; gap: 16px; margin-bottom: 24px; }
    .totals .box { flex: 1; background: #f5f7fa; border: 1.5px solid #e0e0e0; border-radius: 8px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(30,90,173,0.03); }
    .box h3 { font-size: 32px; margin-bottom: 4px; color: #1e5aad; }
    /* .box h3 { font-size: 32px; margin-bottom: 4px; font-variant-numeric: tabular-nums; color: #1e5aad; letter-spacing: 1px; } */
    .box p { font-size: 14px; color: #555; }
    /* Footer */
    .footer { background: #1e5aad; color: #fff; padding: 16px 30px; font-size: 0.8rem; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header" style="border-bottom: 2px solid #e0e0e0; box-shadow: 0 2px 8px rgba(30,90,173,0.04);">
      <div class="logo">Bright Path Financials</div>
      <div class="contact">
        Hello@brightpathfinancials.com<br />929-675-9115
      </div>
    </header>
    <div class="content">
      <h1>Investment Planning Scenarios</h1>
      <p>Enter scenarios below, then click "Compute" to see required weekly investments.</p>


      <div class="controls" id="controlsBar" style="gap: 18px; justify-content: flex-start; flex-wrap: wrap;">
        <button class="btn" id="addRowBtn" style="background: #28a745;">Add Line</button>
        <button class="btn" id="computeBtn" style="background: #ff9800;">Calculate</button>
        <button class="btn" id="downloadBtn" style="background: #607d8b;">Download PDF</button>
      </div>

      <table style="border-radius: 8px; overflow: hidden; border: 1.5px solid #e0e0e0; box-shadow: 0 2px 8px rgba(30,90,173,0.03);">
        <thead style="background: #f5f7fa;">
          <tr style="border-bottom: 2px solid #d0d7e2;">
            <th style="width: 40px; border-right: 1px solid #e0e0e0;"></th>
            <th style="width: 40px; border-right: 1px solid #e0e0e0;"></th>
            <th style="width: 40px; border-right: 1px solid #e0e0e0;"></th>
            <th style="width: 40px; border-right: 1px solid #e0e0e0;"></th>
            <th colspan="3" style="width: 40px; border-right: 18px solid #fff;">
              Investment<br><span style="font-size: 0.9em; font-weight: 400; color: #444;">Needed</span>
            </th>
            <th colspan="2" style="width: 40px; border: 1px solid #e0e0e0;">Totals</th>
          </tr>
          <tr style="border-bottom: 2px solid #d0d7e2;">
            <th style="width: 40px; border-right: 1px solid #e0e0e0;"></th>
            <th style="width: 110px; border-right: 1px solid #e0e0e0;">
              <span style="display: inline-block; width: 110px;">Goal ($)</span>
            </th>
            <th style="width: 60px; border-right: 1px solid #e0e0e0;">
              <span style="display: inline-block; width: 60px;">Start Age</span>
            </th>
            <th style="width: 60px; border-right: 1px solid #e0e0e0;">
              <span style="display: inline-block; width: 60px;">End Age</span>
            </th>
            <th style="background: #f5f7fa; border-bottom: none; padding: 2;">
                <span style="font-weight: 600; color: #222;">Weekly</span>
            </th>
            <th style="background: #f5f7fa; border-bottom: none; padding: 2; ">
                <span style="font-weight: 600; color: #222;">Monthly</span>
            </th>
            <th style="background: #f5f7fa; border-bottom: none; padding: 2; border-right: 18px solid #fff;">
                <span style="font-weight: 600; color: #222;">Yearly</span>
            </th>
            <th style="width: 120px; border-right: 1.5px solid #e0e0e0; color: #1976d2;">Invested</th>
            <th style="width: 120px; border-right: 1.5px solid #e0e0e0; color: #9c27b0;">Gain</th>
          </tr>
        </thead>
        <tbody id="tableRows">
          <!-- Rows will be generated by JavaScript -->
        </tbody>
      </table>

      <div class="totals">
        <div class="box">
          <h3 id="weeklyTotal">$0.00</h3>
          <p>Weekly Total</p>
        </div>
        <div class="box">
          <h3 id="monthlyTotal">$0.00</h3>
          <p>Monthly Total</p>
        </div>
        <div class="box">
          <h3 id="yearlyTotal">$0.00</h3>
          <p>Yearly Total</p>
        </div>
      </div>
    </div>
    <footer class="footer">
      This is a planning estimate. Investment results may vary. Past performance does not guarantee future results.
    </footer>
  </div>

  <!-- Preload and embed font for PDF export -->
  <link href="https://fonts.googleapis.com/css?family=Helvetica+Neue:400,700&display=swap" rel="stylesheet" type="text/css">
  <style>
    @media print {
      body, .container, .content, .header, .footer, .btn, table, th, td, input, .totals, .box {
        font-family: 'Helvetica Neue', Arial, sans-serif !important;
      }
    }
    /* Force font for html2pdf canvas rendering */
    body, .container, .content, .header, .footer, .btn, table, th, td, input, .totals, .box {
      font-family: 'Helvetica Neue', Arial, sans-serif !important;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script>

    function createScenarioRow(goal = '', startAge = '', endAge = '', checked = true) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><button type="button" class="remove-row-btn" title="Remove line" style="background: none; border: none; color: #e53935; font-size: 1.3em; cursor: pointer;">âœ•</button></td>
        <td style="position: relative;">
          <span style="position: absolute; left: 8px; top: 50%; transform: translateY(-50%); font-size: 1rem; color: #888; pointer-events: none;">$</span>
          <input type="text" class="goal" value="${goal}" maxlength="9" style="padding-left: 22px;" inputmode="numeric" pattern="[0-9,]*">
        </td>
        <td><input type="number" class="startAge" value="${startAge}" maxlength="7" style="width: 35px;"></td>
        <td><input type="number" class="endAge" value="${endAge}" maxlength="7" style="width: 35px;"></td>
        <td class="number weekly" style="background: #f8f9fb;">--</td>
        <td class="number monthly" style="background: #f8f9fb;">--</td>
        <td class="number yearly" style="background: #f8f9fb; border-right: 18px solid #fff;">--</td>
        <td class="number total-invested" style="color: #1976d2; background: #f5f7fa; border-right: 1.5px solid #e0e0e0;">--</td>
        <td class="number total-gain" style="color: #9c27b0; background: #f5f7fa; border: 1px solid #e0e0e0;">--</td>
      `;
      return tr;
    }


    // Add 7 empty rows on page load
    window.addEventListener('DOMContentLoaded', () => {
      const tableRows = document.getElementById('tableRows');
      for (let i = 0; i < 7; i++) {
        tableRows.appendChild(createScenarioRow('', '', '', true));
      }
    });

    // Remove row on X button click
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-row-btn')) {
        const tr = e.target.closest('tr');
        if (tr) tr.remove();
      }
    });

    document.getElementById('addRowBtn').addEventListener('click', () => {
      const tableRows = document.getElementById('tableRows');
      tableRows.appendChild(createScenarioRow('', '', '', true));
    });

    function parseGoalInput(val) {
      // Remove commas and $ sign, then parse as float
      return parseFloat(val.replace(/[$,]/g, '')) || 0;
    }

    function formatGoalInput(val) {
      // Remove non-digits, then add commas
      let num = val.replace(/[^\d]/g, '');
      if (!num) return '';
      return num.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function formatNumberWithCommas(num, noCents = false) {
      if (isNaN(num)) return '--';
      if (noCents) {
        return Math.round(num).toLocaleString();
      } else {
        return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
    }

    // Format goal input on input event
    document.addEventListener('input', function(e) {
      if (e.target.classList.contains('goal')) {
        let cursor = e.target.selectionStart;
        let before = e.target.value;
        let formatted = formatGoalInput(before);
        e.target.value = formatted;
        // Try to keep cursor position
        let diff = formatted.length - before.length;
        e.target.setSelectionRange(cursor + diff, cursor + diff);
      }
    });

    document.getElementById('computeBtn').addEventListener('click', () => {
      const rows = document.querySelectorAll('#tableRows tr');
      let weeklySum = 0;
      let monthlySum = 0;
      let yearlySum = 0;
      rows.forEach((row, idx) => {
        const goalInput = row.querySelector('.goal');
        const goalVal = goalInput ? goalInput.value : '';
        const goal = goalInput ? parseGoalInput(goalInput.value) : 0;
        const startVal = row.querySelector('.startAge') ? row.querySelector('.startAge').value : '';
        const start = parseFloat(startVal) || 0;
        const endVal = row.querySelector('.endAge') ? row.querySelector('.endAge').value : '';
        const end = parseFloat(endVal) || 0;
        const years = end - start;
        const weeks = years * 52.1775;

        // New logic: calculate required payment per period to reach goal with compounding
        // r = annual rate, n = years, PMT = payment per period, FV = future value (goal)
        // Each payment compounds: first year 5%, then 10% for each remaining year
        // We'll solve for PMT (payment per year), then divide by 52.1775 or 12 for weekly/monthly

        function futureValueOfPayment(pmt, years) {
          let fv = 0;
          for (let y = 0; y < years; y++) {
            let value = pmt;
            // First year: 5% growth
            value *= 1.05;
            // Remaining years: 10% compounding
            for (let z = 0; z < (years - y - 1); z++) {
              value *= 1.10;
            }
            fv += value;
          }
          return fv;
        }

        let requiredAnnual = 0;
        if (years > 0) {
          // Use binary search to solve for required annual payment
          let low = 0, high = goal * 2, mid, fv;
          for (let i = 0; i < 30; i++) { // 30 iterations is plenty for convergence
            mid = (low + high) / 2;
            fv = futureValueOfPayment(mid, years);
            if (fv < goal) {
              low = mid;
            } else {
              high = mid;
            }
          }
          requiredAnnual = (low + high) / 2;
        }
        const weekly = years > 0 ? requiredAnnual / 52.1775 : 0;
        const monthly = years > 0 ? requiredAnnual / 12 : 0;
        const yearly = years > 0 ? requiredAnnual : 0;

        // Calculate total invested (sum of all annual payments, no growth)
        let totalInvested = 0;
        if (years > 0) {
          totalInvested = requiredAnnual * years;
        }
        // Calculate total gain (goal - total invested)
        let totalGain = 0;
        if (years > 0) {
          totalGain = goal - totalInvested;
        }

        // Weekly and monthly: keep cents, yearly/invested/gain: round and add commas
        row.querySelector('.weekly').innerText = years > 0 ? `$${formatNumberWithCommas(weekly)}` : '--';
        row.querySelector('.monthly').innerText = years > 0 ? `$${formatNumberWithCommas(monthly)}` : '--';
        row.querySelector('.yearly').innerText = years > 0 ? `$${formatNumberWithCommas(yearly, true)}` : '--';
        row.querySelector('.total-invested').innerText = years > 0 ? `$${formatNumberWithCommas(totalInvested, true)}` : '--';
        row.querySelector('.total-gain').innerText = years > 0 ? `$${formatNumberWithCommas(totalGain, true)}` : '--';
        weeklySum += weekly;
        monthlySum += monthly;
        yearlySum += yearly;
      });
      document.getElementById('weeklyTotal').innerText = `$${formatNumberWithCommas(weeklySum)}`;
      document.getElementById('monthlyTotal').innerText = `$${formatNumberWithCommas(monthlySum)}`;
      document.getElementById('yearlyTotal').innerText = `$${formatNumberWithCommas(yearlySum, true)}`;
    });

    document.getElementById('downloadBtn').addEventListener('click', () => {
      // Hide controls before PDF
      const controls = document.getElementById('controlsBar');
      controls.style.visibility = 'hidden';

      // Clone the container to manipulate for PDF
      const element = document.querySelector('.container');
      const clone = element.cloneNode(true);

      // Remove first column (remove-row-btn) from header and rows
      const table = clone.querySelector('table');
      if (table) {
        // Remove first th in both header rows
        const theadRows = table.querySelectorAll('thead tr');
        theadRows.forEach(tr => {
          if (tr.children[0]) tr.removeChild(tr.children[0]);
        });
        // Remove first td in all body rows
        const bodyRows = table.querySelectorAll('tbody tr');
        bodyRows.forEach(tr => {
          if (tr.children[0]) tr.removeChild(tr.children[0]);
        });
      }

      // Increase font size for controls in the PDF
      const pdfControls = clone.querySelectorAll('.controls-select, .controls-input, .controls-button');
      pdfControls.forEach(el => {
        el.style.fontSize = '14px'; // Adjust this value as needed
        el.style.fontFamily = 'Arial, Helvetica Neue, Helvetica, sans-serif';
      });

      clone.querySelectorAll('.box h3').forEach(el => {
        el.style.fontFamily = 'Arial, Helvetica Neue, Helvetica, sans-serif';
        el.style.fontWeight = 'bold';
      });

      html2pdf().set({ margin:0, filename:'investment_plan.pdf', html2canvas:{ scale:2, useCORS:true }, pagebreak: { mode: ['avoid-all'] } })
        .from(clone)
        .save()
        .then(() => {
          controls.style.visibility = '';
        })
        .catch(() => {
          controls.style.visibility = '';
        });
    });
  </script>
</body>
</html>